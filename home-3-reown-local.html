<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memeworld - Reown Local</title>
  <link rel="icon" href="assets/img/favicon.png" type="image/png">
  <link rel="stylesheet" href="assets/css/bootstrap.css">
  <link rel="stylesheet" href="assets/css/bootstrap-icons.css">
  <link rel="stylesheet" href="assets/css/simplebar.css">
  <link rel="stylesheet" href="assets/css/swiper-bundle.css">
  <link rel="stylesheet" href="assets/css/ff-1.css">
  <link rel="stylesheet" href="assets/css/ff-2.css">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="bg-success-emphasis overflow-x-hidden">
  <div class="container py-5">
    <h1 class="text-light">Reown AppKit — локальная загрузка</h1>
    <p class="text-light">Эта страница грузит AppKit с вашего домена (assets/js/reown), без сторонних CDN.</p>
    <a href="#" class="btn btn-lg btn-danger my-3" data-appkit-open>Connect Wallet</a>
    <div id="fallback"></div>
  </div>

  <!-- your other page content could be placed here -->

  <!-- Reown AppKit integration (LOCAL FIRST, then multi-CDN fallbacks) -->
  <script type="module">
    const PROJECT_ID = "6d6910ef3c0da38d8c4a5cfae868e032"; // ваш реальный Project ID

    const sources = [
      // 1) Local copies served from your domain (created during Netlify build)
      { appkit: "/assets/js/reown/appkit.js",
        networks: "/assets/js/reown/networks.js",
        adapter: "/assets/js/reown/adapter-wagmi.js" },

      // 2) Fallback CDNs if local files suddenly отсутствуют
      { appkit: "https://unpkg.com/@reown/appkit/+esm",
        networks: "https://unpkg.com/@reown/appkit/networks/+esm",
        adapter: "https://unpkg.com/@reown/appkit-adapter-wagmi/+esm" },
      { appkit: "https://esm.sh/@reown/appkit",
        networks: "https://esm.sh/@reown/appkit/networks",
        adapter: "https://esm.sh/@reown/appkit-adapter-wagmi" },
      { appkit: "https://cdn.jsdelivr.net/npm/@reown/appkit/+esm",
        networks: "https://cdn.jsdelivr.net/npm/@reown/appkit/networks/+esm",
        adapter: "https://cdn.jsdelivr.net/npm/@reown/appkit-adapter-wagmi/+esm" }
    ];

    async function init() {
      let lastError = null;
      for (const src of sources) {
        try {
          const [{ createAppKit }, networksMod, { WagmiAdapter }] = await Promise.all([
            import(/* @vite-ignore */ src.appkit),
            import(/* @vite-ignore */ src.networks),
            import(/* @vite-ignore */ src.adapter)
          ]);

          const { mainnet, arbitrum } = networksMod;
          const wagmiAdapter = new WagmiAdapter({ projectId: PROJECT_ID, networks: [mainnet, arbitrum] });

          const appkit = createAppKit({
            adapters: [wagmiAdapter],
            projectId: PROJECT_ID,
            networks: [mainnet, arbitrum],
            metadata: {
              name: document.title,
              description: "Reown AppKit local-first",
              url: window.location.origin,
              icons: [ (document.querySelector('link[rel="icon"]')?.href) || (new URL('/favicon.ico', location.href)).href ]
            }
          });

          // Add a floating button if none present
          if (!document.querySelector('appkit-button')) {
            const wrap = document.createElement('div');
            wrap.style.position = 'fixed';
            wrap.style.right = '16px';
            wrap.style.bottom = '16px';
            wrap.style.zIndex = '9999';
            wrap.innerHTML = '<appkit-button></appkit-button> <appkit-network-button></appkit-network-button>';
            document.body.appendChild(wrap);
          }

          // Open modal by data attribute
          document.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-appkit-open]');
            if (btn) {
              e.preventDefault();
              appkit.open();
            }
          }, { passive: false });

          console.log("[Reown] initialized via", src.appkit);
          return;
        } catch (err) {
          lastError = err;
          console.warn("[Reown] failed via", src.appkit, err);
        }
      }
      const div = document.getElementById('fallback');
      if (div) {
        div.innerHTML = '<div class="alert alert-danger m-3">Не удалось загрузить Reown ни локально, ни с CDN. Проверьте, что Netlify билд скопировал файлы в <code>assets/js/reown</code>.</div>';
      }
      alert("Не удалось загрузить Reown локально и с CDN. Проверьте build на Netlify и папку assets/js/reown.");
      throw lastError || new Error("Reown load failed");
    }

    init();
  </script>
  <!-- End Reown AppKit integration -->

</body>
</html>
